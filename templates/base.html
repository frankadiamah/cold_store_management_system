<!DOCTYPE html>
{% load static %}
{% load group_tags %}
{% load role_tags %}
<html lang="en" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  {% comment %} <link rel="icon" type="image/png" href="{% static 'images/favicon.png' %}"> {% endcomment %}
  <link rel="icon" type="image/x-icon" href="{% static 'images/favicon.ico' %}">
  <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/favicon-16x16.png' %}">
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/favicon-32x32.png' %}">
  <link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/apple-touch-icon.png' %}">

  <title>{% block title %}ColdStore â€” Dashboard{% endblock %}</title>


  <!-- Apply saved theme BEFORE page paints -->



 <!-- 1) Apply saved theme BEFORE anything renders -->
<script>
  (function () {
    const root = document.documentElement;
    let saved = null;
    try {
      saved = localStorage.getItem("theme");
    } catch (err) {
      saved = null;
    }
    const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
    const theme = (saved === "dark" || saved === "light") ? saved : (prefersDark ? "dark" : "light");
    root.classList.toggle("dark", theme === "dark");
    root.setAttribute("data-theme", theme);
    root.style.colorScheme = theme;
  })();
</script>

<!-- 2) Load Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- 3) Tailwind config (ensure darkMode uses class) -->
<script>
  if (window.tailwind) {
    window.tailwind.config = Object.assign({}, window.tailwind.config, {
      darkMode: "class"
    });
  }
</script>

  <style>
    .sidebar-scroll { height: calc(100vh - 4rem); overflow: auto; }

    /* General Card Styling */
    .card {
      background-color: #ffffff;
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }
    .dark .card {
      background-color: #1e293b;
      color: #e2e8f0;
    }

    /* Primary Button */
    .btn-primary {
      background-color: #2563eb;
      color: #ffffff;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      font-weight: 500;
      text-align: center;
      display: inline-block;
      transition: background-color 0.2s ease;
    }
    .btn-primary:hover { background-color: #1d4ed8; }

    /* Secondary Button */
    .btn-secondary {
      background-color: #f3f4f6;
      color: #111827;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      border: 1px solid #d1d5db;
      font-weight: 500;
      text-align: center;
      display: inline-block;
    }
    .btn-secondary:hover { background-color: #e5e7eb; }

    /* Form Controls */
    .form-control {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .form-control:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 2px rgba(37,99,235,0.2);
    }
    .dark .form-control {
      background-color: #1e293b;
      color: #e2e8f0;
      border-color: #334155;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-slate-50 text-slate-800 dark:bg-slate-950 dark:text-slate-100 font-inter transition-colors duration-300">

<div class="min-h-screen flex">

  <!-- Sidebar -->
  <aside class="w-72 bg-white dark:bg-slate-900 border-r dark:border-slate-700 hidden md:block">
    <div class="p-4 border-b dark:border-slate-700 flex items-center justify-between gap-3">
      <a href="{% url 'inventory_dashboard' %}" class="flex items-center gap-3">
        <div class="w-10 h-10 bg-blue-600 text-white rounded flex items-center justify-center font-bold">GN</div>
        <div>
          <div class="text-lg font-semibold text-slate-800 dark:text-slate-100">Gye Nyame cold store </div>
          <div class="text-xs text-slate-500 dark:text-slate-400">Inventory & Sales</div>
        </div>
      </a>

      <!-- Desktop theme toggle -->
      <button id="darkModeToggleDesktop" type="button" data-theme-toggle aria-pressed="false" aria-label="Toggle theme"
        class="inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium
               hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:hover:bg-slate-800"
        title="Toggle theme">
        <span class="themeIcon">ðŸŒ™</span>
        <span class="themeText">Dark</span>
      </button>
    </div>

    <nav class="p-4 sidebar-scroll">
      <ul class="space-y-1">

        <li><a href="{% url 'inventory_dashboard' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Dashboard</a></li>
        <li><a href="{% url 'product_list' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Products</a></li>

        <li class="mt-3 pt-3 border-t border-slate-200 dark:border-slate-700 text-xs uppercase text-slate-500 dark:text-slate-400">
          Price Lists
        </li>

        {% comment %} <li><a href="{% url 'retail_price_list' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Retail Prices</a></li> {% endcomment %}
        {% if request.user|has_group:"Retail" %}
          <li><a href="{% url 'sale_list' %}?type=retail">Retail Sales</a></li>
        {% endif %}
        {% if request.user|has_group:"Wholesale" %}
          <li><a href="{% url 'sale_list' %}?type=wholesale">Wholesale</a></li>
        {% endif %}
        {% if request.user|has_group:"Admin" %}
          <li><a href="{% url 'sale_list' %}?type=wholesale">Wholesale</a></li>
          <li><a href="{% url 'sale_list' %}?type=retail">Retail Sales</a></li>
          
          {% comment %} <li><a href="{% url 'wholesale_price_list' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Wholesale Prices</a></li> {% endcomment %}
          <li><a href="{% url 'stock_in' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Stock In</a></li>
          <li><a href="{% url 'stock_out' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Stock Out</a></li>
        {% endif %}

        <li class="mt-3 pt-3 border-t border-slate-200 dark:border-slate-700 text-xs uppercase text-slate-500 dark:text-slate-400">Sales</li>
        <li><a href="{% url 'create_sale' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">âž• New Sale</a></li>

        {% if user.is_authenticated %}
          <li>
            <a href="{% url 'credit_sales_list' %}"
               class="block px-3 py-2 rounded hover:bg-slate-100 dark:hover:bg-slate-800">
              ðŸ’³ Credit Sales
            </a>
          </li>
        {% endif %}

        <li><a href="{% url 'sale_list' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">âœ… Sales Records</a></li>
        <li><a href="{% url 'add_expense' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Add Expense</a></li>

        <li class="mt-3 pt-3 border-t border-slate-200 dark:border-slate-700 text-xs uppercase text-slate-500 dark:text-slate-400">Company Records</li>
        <li><a href="{% url 'employees_list' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Employees</a></li>
        <li><a href="{% url 'attendance_dashboard' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Attendance</a></li>
        <li><a href="{% url 'my_attendance' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">My Attendance</a></li>

        {% if request.user|has_group:"Admin" or request.user|has_group:"Accountant" %}
          <li><a href="{% url 'assets:vehicle_list' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">ðŸš— Company Cars</a></li>

          {% is_super_admin request.user as superadmin %}

          {% if superadmin %}
            <li><a href="{% url 'analytics_dashboard' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Analytics</a></li>
            <li><a href="{% url 'reports_summary' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Reports</a></li>
            <li><a href="{% url 'finance:account_list' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Finance</a></li>
          {% endif %}

          {% comment %} <li><a href="{% url 'finance:account_list' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Finance</a></li> {% endcomment %}
          {% comment %} <li><a href="{% url 'reports_summary' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Reports</a></li> {% endcomment %}
          {% comment %} <li><a href="{% url 'analytics_dashboard' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Analytics</a></li> {% endcomment %}
        {% endif %}
      </ul>
    </nav>

    <div class="p-4 border-t dark:border-slate-700">
      <div class="text-xs text-slate-500 dark:text-slate-400">Logged in as</div>
      <div class="mt-2 font-medium text-slate-800 dark:text-slate-100">
        {{ request.user.get_full_name|default:request.user.username }}
      </div>

      <form method="post" action="{% url 'users:logout' %}">
        {% csrf_token %}
        <button class="text-sm text-red-600 hover:underline mt-2">Logout</button>
      </form>
    </div>
  </aside>

  <!-- Main -->
  {% comment %} <div class="flex-1"> {% endcomment %}
    <div class="flex-1 bg-slate-50 dark:bg-slate-950 transition-colors duration-300">


    <!-- Topbar for small screens -->
    <header class="md:hidden bg-white dark:bg-slate-900 border-b dark:border-slate-700 p-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <button id="mobileMenuBtn" class="p-2 rounded bg-slate-100 dark:bg-slate-800">â˜°</button>
        <a href="{% url 'inventory_dashboard' %}" class="font-semibold text-slate-800 dark:text-slate-100">ColdStore</a>
      </div>

      <div class="flex items-center gap-2">
        <!-- Mobile theme toggle -->
        <button id="darkModeToggleMobile" type="button" data-theme-toggle aria-pressed="false" aria-label="Toggle theme"
          class="inline-flex items-center gap-2 rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium
                 hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:hover:bg-slate-800">
          <span class="themeIcon">ðŸŒ™</span>
          <span class="themeText">Dark</span>
        </button>

        <a href="{% url 'users:dashboard' %}" class="text-sm text-slate-800 dark:text-slate-100">Profile</a>
      </div>
    </header>

    <main class="p-6">
      {% block content %}
      
      {% endblock %}
    </main>
  </div>
</div>

<!-- Toast notifications -->
{% if messages %}
  <div id="toast-container" class="fixed top-4 right-4 space-y-2 z-50">
    {% for message in messages %}
      <div class="px-4 py-3 rounded-lg shadow text-white
        {% if message.tags == 'success' %}bg-green-500
        {% elif message.tags == 'error' %}bg-red-500
        {% else %}bg-blue-500{% endif %}">
        {{ message }}
      </div>
    {% endfor %}
  </div>


  <script>
    setTimeout(() => {
      const container = document.getElementById('toast-container');
      if (container) container.style.display = 'none';
    }, 3000);
  </script>
{% endif %}

<script>
  // Mobile menu toggle
  const btn = document.getElementById('mobileMenuBtn');
  if (btn) {
    btn.addEventListener('click', () => {
      const aside = document.querySelector('aside');
      if (aside) aside.classList.toggle('hidden');
    });
  }

  // Theme toggle + keep both buttons in sync
  const THEME_KEY = "theme";
  const root = document.documentElement;
  const themeToggles = document.querySelectorAll("[data-theme-toggle]");

  function getSystemTheme() {
    return (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) ? "dark" : "light";
  }

  function getSavedTheme() {
    try {
      const saved = localStorage.getItem(THEME_KEY);
      return (saved === "dark" || saved === "light") ? saved : null;
    } catch (err) {
      return null;
    }
  }

  function updateThemeUI(theme) {
    const isDark = theme === "dark";
    document.querySelectorAll(".themeIcon").forEach(el => {
      el.textContent = isDark ? "\u2600\uFE0F" : "\uD83C\uDF19";
    });
    document.querySelectorAll(".themeText").forEach(el => {
      el.textContent = isDark ? "Light" : "Dark";
    });
    themeToggles.forEach(btn => btn.setAttribute("aria-pressed", String(isDark)));
  }

  function applyTheme(theme, persist) {
    root.classList.toggle("dark", theme === "dark");
    root.setAttribute("data-theme", theme);
    root.style.colorScheme = theme;
    if (persist) {
      try {
        localStorage.setItem(THEME_KEY, theme);
      } catch (err) {
        // Ignore storage errors; theme still applies for this session.
      }
    }
    updateThemeUI(theme);
  }

  function toggleTheme() {
    const next = root.classList.contains("dark") ? "light" : "dark";
    applyTheme(next, true);
  }

  // set correct label/icon on page load
  const initialTheme = getSavedTheme() || getSystemTheme();
  applyTheme(initialTheme, false);

  themeToggles.forEach(btn => btn.addEventListener("click", toggleTheme));

  // keep in sync with OS when user has not chosen a theme
  const media = window.matchMedia ? window.matchMedia("(prefers-color-scheme: dark)") : null;
  if (media) {
    media.addEventListener("change", (e) => {
      if (!getSavedTheme()) applyTheme(e.matches ? "dark" : "light", false);
    });
  }
</script>

</body>
</html>

