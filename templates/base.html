<!DOCTYPE html>
{% load group_tags %}
{% load role_tags %}
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}ColdStore â€” Dashboard{% endblock %}</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Apply saved theme BEFORE page paints -->
  <script>
    (function () {
      const saved = localStorage.getItem("theme");
      const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
      const theme = saved || (prefersDark ? "dark" : "light");
      if (theme === "dark") document.documentElement.classList.add("dark");
    })();
  </script>

  <style>
    .sidebar-scroll { height: calc(100vh - 4rem); overflow: auto; }

    /* General Card Styling */
    .card {
      background-color: #ffffff;
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }
    .dark .card {
      background-color: #1e293b;
      color: #e2e8f0;
    }

    /* Primary Button */
    .btn-primary {
      background-color: #2563eb;
      color: #ffffff;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      font-weight: 500;
      text-align: center;
      display: inline-block;
      transition: background-color 0.2s ease;
    }
    .btn-primary:hover { background-color: #1d4ed8; }

    /* Secondary Button */
    .btn-secondary {
      background-color: #f3f4f6;
      color: #111827;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      border: 1px solid #d1d5db;
      font-weight: 500;
      text-align: center;
      display: inline-block;
    }
    .btn-secondary:hover { background-color: #e5e7eb; }

    /* Form Controls */
    .form-control {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .form-control:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 2px rgba(37,99,235,0.2);
    }
    .dark .form-control {
      background-color: #1e293b;
      color: #e2e8f0;
      border-color: #334155;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-slate-50 text-slate-800 dark:bg-slate-950 dark:text-slate-100 font-inter transition-colors duration-300">

<div class="min-h-screen flex">

  <!-- Sidebar -->
  <aside class="w-72 bg-white dark:bg-slate-900 border-r dark:border-slate-700 hidden md:block">
    <div class="p-4 border-b dark:border-slate-700 flex items-center justify-between gap-3">
      <a href="{% url 'inventory_dashboard' %}" class="flex items-center gap-3">
        <div class="w-10 h-10 bg-blue-600 text-white rounded flex items-center justify-center font-bold">CS</div>
        <div>
          <div class="text-lg font-semibold text-slate-800 dark:text-slate-100">ColdStore</div>
          <div class="text-xs text-slate-500 dark:text-slate-400">Inventory & Sales</div>
        </div>
      </a>

      <!-- Desktop theme toggle -->
      <button id="darkModeToggleDesktop" type="button"
              class="p-2 rounded bg-slate-200 dark:bg-slate-700 text-sm"
              title="Toggle theme">
        ðŸŒ“
      </button>
    </div>

    <nav class="p-4 sidebar-scroll">
      <ul class="space-y-1">

        <li><a href="{% url 'inventory_dashboard' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Dashboard</a></li>
        <li><a href="{% url 'product_list' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Products</a></li>

        
          <li class="mt-3 pt-3 border-t border-slate-200 dark:border-slate-700 text-xs uppercase text-slate-500 dark:text-slate-400">
            Price Lists
          </li>
          {% comment %} {% if request.user|has_group:"staff" %} {% endcomment %}
          <li><a href="{% url 'retail_price_list' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Retail Prices</a></li>
          {% comment %} {% endif %} {% endcomment %}

          {% if request.user|has_group:"Admin" %}
          <li><a href="{% url 'wholesale_price_list' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Wholesale Prices</a></li>
        

        <li><a href="{% url 'stock_in' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Stock In</a></li>
        <li><a href="{% url 'stock_out' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Stock Out</a></li>
        {% endif %}
        <li class="mt-3 pt-3 border-t border-slate-200 dark:border-slate-700 text-xs uppercase text-slate-500 dark:text-slate-400">Sales</li>
        <li><a href="{% url 'create_sale' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">âž• New Sale</a></li>
        {% if user.is_authenticated %}
  <li>
    <a href="{% url 'credit_sales_list' %}"
       class="block px-3 py-2 rounded hover:bg-slate-100 dark:hover:bg-slate-800">
      ðŸ’³ Credit Sales
    </a>
  </li>
{% endif %}

        <li><a href="{% url 'sale_list' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">âœ… Sales Records</a></li>
        <li><a href="{% url 'add_expense' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Add Expense</a></li>

        <li class="mt-3 pt-3 border-t border-slate-200 dark:border-slate-700 text-xs uppercase text-slate-500 dark:text-slate-400">Company Records</li>
        <li><a href="{% url 'employees_list' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Employees</a></li>
        <li><a href="{% url 'attendance_dashboard' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Attendance</a></li>
        <li><a href="{% url 'my_attendance' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">My Attendance</a></li>

        {% if request.user|has_group:"Admin" or request.user|has_group:"Accountant" %}
          <!-- âœ… Vehicle assets app link -->
          <li><a href="{% url 'assets:vehicle_list' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">ðŸš— Company Cars</a></li>
        

          {% comment %} 
G) Sidebar / base.html: show the menu to SubAdmin (since they can access), BUT the data will still be scoped
So you do not need to hide Analytics/Reports/Stock/Finance links.
Even if SubAdmin clicks them, they only see their own records.
          {% endcomment %}

      {% is_super_admin request.user as superadmin %}

      {% if superadmin %}
        <a href="{% url 'analytics_dashboard' %}">Analytics</a>
        <a href="{% url 'reports_summary' %}">Reports</a>
        <a href="{% url 'finance:account_list' %}">Finance</a>
      {% endif %}


        <li><a href="{% url 'finance:account_list' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Finance</a></li>
        <li><a href="{% url 'reports_summary' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Reports</a></li>
        <li><a href="{% url 'analytics_dashboard' %}" class="block py-2 px-3 rounded hover:bg-slate-50 dark:hover:bg-slate-700">Analytics</a></li>
      {% endif %}
      </ul>
    </nav>

    <div class="p-4 border-t dark:border-slate-700">
      <div class="text-xs text-slate-500 dark:text-slate-400">Logged in as</div>
      <div class="mt-2 font-medium text-slate-800 dark:text-slate-100">
        {{ request.user.get_full_name|default:request.user.username }}
      </div>

      <form method="post" action="{% url 'users:logout' %}">
        {% csrf_token %}
        <button class="text-sm text-red-600 hover:underline mt-2">Logout</button>
      </form>
    </div>
  </aside>

  <!-- Main -->
  <div class="flex-1">

    <!-- Topbar for small screens -->
    <header class="md:hidden bg-white dark:bg-slate-900 border-b dark:border-slate-700 p-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <button id="mobileMenuBtn" class="p-2 rounded bg-slate-100 dark:bg-slate-800">â˜°</button>
        <a href="{% url 'inventory_dashboard' %}" class="font-semibold text-slate-800 dark:text-slate-100">ColdStore</a>
      </div>
      <div class="flex items-center gap-2">
        <!-- Mobile theme toggle -->
        <button id="darkModeToggleMobile" class="p-2 rounded bg-slate-200 dark:bg-slate-700 text-sm">ðŸŒ“</button>
        <a href="{% url 'users:dashboard' %}" class="text-sm text-slate-800 dark:text-slate-100">Profile</a>
      </div>
    </header>

    <main class="p-6">
      {% block content %}{% endblock %}
    </main>
  </div>
</div>

<!-- Toast notifications (single version) -->
{% if messages %}
  <div id="toast-container" class="fixed top-4 right-4 space-y-2 z-50">
    {% for message in messages %}
      <div class="px-4 py-3 rounded-lg shadow text-white
        {% if message.tags == 'success' %}bg-green-500
        {% elif message.tags == 'error' %}bg-red-500
        {% else %}bg-blue-500{% endif %}">
        {{ message }}
      </div>
    {% endfor %}
  </div>

  <script>
    setTimeout(() => {
      const container = document.getElementById('toast-container');
      if (container) container.style.display = 'none';
    }, 3000);
  </script>
{% endif %}

<script>
  // Mobile menu toggle
  const btn = document.getElementById('mobileMenuBtn');
  if (btn) {
    btn.addEventListener('click', () => {
      const aside = document.querySelector('aside');
      if (aside) aside.classList.toggle('hidden');
    });
  }

  // Theme toggle (works for both buttons)
  function toggleTheme() {
    const htmlEl = document.documentElement;
    htmlEl.classList.toggle('dark');
    localStorage.setItem('theme', htmlEl.classList.contains('dark') ? 'dark' : 'light');
  }

  const tMobile = document.getElementById('darkModeToggleMobile');
  if (tMobile) tMobile.addEventListener('click', toggleTheme);

  const tDesktop = document.getElementById('darkModeToggleDesktop');
  if (tDesktop) tDesktop.addEventListener('click', toggleTheme);
</script>

</body>
</html>
